/*! openkarotz-js v0.3.0 | (c) 2013 Olivier Bagot | opensource.org/licenses/MIT
 * http://github.com/hobbe/openkarotz-js
 */
'use strict';var OpenKarotz=function(karotz_ip){if(karotz_ip===undefined){console.log("variable karotz_ip is required!");throw new Error("variable karotz_ip is required!");}this.WHITE="FFFFFF";this.BLACK="000000";this.RED="FF0000";this.GREEN="00FF00";this.BLUE="0000FF";this.VIOLET="660099";this.CYAN="00FFFF";this.YELLOW="FFFF00";this.PINK="FF00CB";this.ORANGE="FF9900";this.ip=karotz_ip;this.state={"sleep":1,"version":"unknown","karotz_free_space":"unknown"};var karotz_url="http://"+karotz_ip;var karotz_api=karotz_url+"/cgi-bin";var apiStatus=karotz_api+'/status';var apiSleep=karotz_api+'/sleep';var apiWakeup=karotz_api+'/wakeup';var apiReboot=karotz_api+'/reboot';var apiSound=karotz_api+'/sound';var apiSoundControl=karotz_api+'/sound_control';var apiLeds=karotz_api+'/leds';var apiEars=karotz_api+'/ears';var apiEarsReset=karotz_api+'/ears_reset';var apiEarsRandom=karotz_api+'/ears_random';var apiTts=karotz_api+'/tts';var apiSnapshot=karotz_api+'/snapshot';var apiSnapshotGet=karotz_api+'/snapshot_get';var apiMoods=karotz_api+'/apps/moods';this.getIp=function(){return this.ip};this.getUrl=function(){return karotz_url};this.getApiUrl=function(){return karotz_api};this.getState=function(){return this.state};this.status=function(onSuccess,onFailure){console.log('status: '+apiStatus);var carrot=this;$.get(apiStatus,function(data){console.log("status: "+data);if(data){var result=JSON.parse(data);carrot.state=result;console.log(carrot.state);if(onSuccess){onSuccess(result)}}else{carrot.state.sleep=1;if(onFailure){onFailure("rabbit is offline")}}})};this.sleep=function(onSuccess,onFailure){var carrot=this;$.get(apiSleep,function(data){console.log("sleep: "+data);var result=JSON.parse(data);if(result.return==0){carrot.state.sleep=1;if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.wakeup=function(onSuccess,onFailure){var carrot=this;$.get(apiWakeup+"?silent=1",function(data){console.log("wakeup: "+data);var result=JSON.parse(data);if(result.return==0){carrot.state.sleep=0;if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.reboot=function(onSuccess,onFailure){$.get(apiReboot,function(data){console.log("reboot: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.sound=function(url,onSuccess,onFailure){$.get(apiSound+"?url="+url,function(data){console.log("sound: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.soundInternal=function(id,onSuccess,onFailure){$.get(apiSound+"?id="+id,function(data){console.log("sound id "+id+": "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.soundControl=function(cmd,onSuccess,onFailure){$.get(apiSoundControl+"?cmd="+cmd,function(data){console.log("sound_control("+cmd+"): "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.soundControlPause=function(onSuccess,onFailure){this.soundControl("pause",onSuccess,onFailure)};this.soundControlQuit=function(onSuccess,onFailure){this.soundControl("quit",onSuccess,onFailure)};this.leds=function(color,pulse,onSuccess,onFailure){var pulseOption="?";if(pulse&&pulse==true){pulseOption+="pulse=1&"}$.get(apiLeds+pulseOption+"color="+color,function(data){console.log("leds: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.ledsPulse=function(color,onSuccess,onFailure){this.leds(color,true,onSuccess,onFailure)};this.ledsFixed=function(color,onSuccess,onFailure){this.leds(color,false,onSuccess,onFailure)};this.ears=function(left,right,onSuccess,onFailure){$.get(apiEars+"?left="+left+"&right="+right,function(data){console.log("ears: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.earsReset=function(onSuccess,onFailure){$.get(apiEarsReset,function(data){console.log("ears_reset: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.earsRandom=function(onSuccess,onFailure){$.get(apiEarsRandom,function(data){console.log("ears_random: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.moods=function(id,onSuccess,onFailure){var idOption="";if(id){idOption+="?id="+id}$.get(apiMoods+idOption,function(data){console.log("moods: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.tts=function(text,voice,nocache,onSuccess,onFailure){var textOption='?text="Bonjour"';if(text){textOption='?text="'+encodeURIComponent(text.replace(new RegExp("'","g"),""))+'"'}var voiceOption="&voice=margaux";if(voice){voiceOption="&voice="+encodeURIComponent(voice)}var nocacheOption="&nocache=0";if(nocache&&nocache==true){nocacheOption="&nocache=1"}var cmd=apiTts+textOption+voiceOption+nocacheOption;console.log("tts: "+cmd);$.get(cmd,function(data){console.log("tts: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})};this.snapshot=function(silent,onSuccess,onFailure){var silentOption='?silent=0';if(silent&&silent==true){silentOption='?silent=1'}var cmd=apiSnapshot+silentOption;console.log("silent: "+cmd);$.get(cmd,function(data){console.log("silent: "+data);var result=JSON.parse(data);if(result.return==0){if(onSuccess){onSuccess(result)}}else{if(onFailure){onFailure(result.msg)}}})}this.getSnapshotUrl=function(filename){var url=apiSnapshotGet+'?filename='+filename;console.log("getSnapshotUrl: "+url);return url}return this};